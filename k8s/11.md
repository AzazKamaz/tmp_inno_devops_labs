## Lab11

### 2

-
    ```bash
    kubectl -n lab11 create secret generic db-user-pass \
        --from-literal=username=admin \
        --from-literal=password="$(openssl rand -base64 32)"
    ```
    ```
    secret/db-user-pass created
    ```
-
    ```bash
    kubectl -n lab11 describe secret
    ```
    ```
    Name:         db-user-pass
    Namespace:    lab11
    Labels:       <none>
    Annotations:  <none>

    Type:  Opaque

    Data
    ====
    password:  44 bytes
    username:  5 bytes
    ```
-
    ```bash
    kubectl -n lab11 get secret db-user-pass -o jsonpath='{.data.username}' | base64 --decode
    ```
    ```
    admin
    ```
-
    ```bash
    kubectl -n lab11 get secret db-user-pass -o jsonpath='{.data.password}' | base64 --decode
    ```
    ```
    KUv/7SCi11uFsutbA5I9Rwiw2dpesy9r7loJzeXARro=
    ```

### 3

-
    ```bash
    helm install -n lab11 app-python ./charts/app-python \
        --set secrets.username=manager \
        --set secrets.password="$(openssl rand -base64 32)"
    ```
    ```
    NAME: app-python
    LAST DEPLOYED: Wed Dec 14 07:14:06 2022
    NAMESPACE: lab11
    STATUS: deployed
    REVISION: 1
    NOTES:
    1. Get the application URL by running these commands:
      export POD_NAME=$(kubectl get pods --namespace lab11 -l "app.kubernetes.io/name=app-python,app.kubernetes.io/instance=app-python" -o jsonpath="{.items[0].metadata.name}")
      export CONTAINER_PORT=$(kubectl get pod --namespace lab11 $POD_NAME -o jsonpath="{.spec.containers[0].ports[0].containerPort}")
      echo "Visit http://127.0.0.1:8080 to use your application"
      kubectl --namespace lab11 port-forward $POD_NAME 8080:$CONTAINER_PORT
    ```
-
    ```bash
    kubectl -n lab11 exec pod/app-python-5df5f656c8-zrwcg -- env | grep SECRET_
    ```
    ```
    SECRET_USERNAME=manager
    SECRET_PASSWORD=W0Mc12x2PZ0lFf6JXHA+QSMpCAgtdeKbkSUPI5EvcSs=
    ```

### 5

-
    ```bash
    helm install -n lab11 app-python-oom ./charts/app-python \
        --set resources.requests.cpu=100m \
        --set resources.requests.memory=64Mi \
        --set resources.limits.cpu=200m \
        --set resources.limits.memory=128Mi
    ```
-
    ```bash
    kubectl --namespace lab11 port-forward app-python-oom-64ff697b5d-bx6dm 8080:8080
    ```
- repeat `curl http://localhost:8080/outofmemory -X POST` until it crashes (you can check bytes consumed in `length` field)
-
    ```bash
    kubectl -n lab11 get pod
    ```
    ```
    NAME                              READY   STATUS    RESTARTS        AGE
    app-python-oom-64ff697b5d-bx6dm   1/1     Running   1 (22s ago)     1m7s
    ```